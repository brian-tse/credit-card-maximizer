<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CardMax - My Cards Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    /* My Cards Page Specific Styles */
    .my-cards-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .search-container {
      position: relative;
      width: 100%;
      max-width: 400px;
    }

    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 1rem;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 0.875rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }

    /* Card Selection Grid */
    .card-selector-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .card-selector-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: var(--radius);
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }

    .card-selector-item:hover {
      border-color: var(--border-color);
      background: var(--bg-card);
    }

    .card-selector-item.selected {
      border-color: var(--accent-blue);
      background: rgba(59, 130, 246, 0.1);
    }

    .card-selector-item .card-color-bar {
      width: 6px;
      height: 50px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .card-selector-item .card-details {
      flex: 1;
      min-width: 0;
    }

    .card-selector-item .card-name {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
    }

    .card-selector-item .card-issuer {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }

    .card-selector-item .card-fee {
      font-size: 0.8rem;
      color: var(--accent-purple);
    }

    .card-selector-item .card-checkbox {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .card-selector-item.selected .card-checkbox {
      background: var(--accent-blue);
      border-color: var(--accent-blue);
      color: white;
    }

    /* My Cards List */
    .my-cards-section {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .my-cards-section h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .my-card-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-card);
      border-radius: 10px;
      margin-bottom: 0.75rem;
    }

    .my-card-item:last-child {
      margin-bottom: 0;
    }

    .my-card-item .card-color-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .my-card-item .card-info {
      flex: 1;
    }

    .my-card-item .card-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .my-card-item .card-subtitle {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .my-card-item .date-picker-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .my-card-item .date-picker-group label {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .month-year-picker {
      display: flex;
      gap: 0.5rem;
    }

    .month-year-picker select {
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 0.8rem;
    }

    .my-card-item .remove-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 1.25rem;
      padding: 0.25rem;
      opacity: 0.5;
      transition: all 0.2s;
    }

    .my-card-item .remove-btn:hover {
      opacity: 1;
      color: #ef4444;
    }

    /* Save Button Area */
    .save-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
    }

    .save-status {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .save-status.saved {
      color: var(--accent-green);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
    }

    .empty-state h3 {
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .empty-state p {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    /* Quick Stats */
    .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .quick-stat-card {
      background: var(--bg-secondary);
      border-radius: var(--radius);
      padding: 1.25rem;
      text-align: center;
      border: 1px solid var(--border-color);
    }

    .quick-stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--accent-blue);
    }

    .quick-stat-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="navbar-content">
      <a href="index.html" class="logo">üí≥ CardMax</a>
      <ul class="nav-links">
        <li><a href="index.html" class="active">My Cards</a></li>
        <li><a href="pages/cards.html">All Cards</a></li>
        <li><a href="pages/compare.html">Compare</a></li>
      </ul>
    </div>
  </nav>

  <!-- Sub-Navigation -->
  <nav class="sub-navbar">
    <div class="sub-navbar-content">
      <ul class="sub-nav-links">
        <li><a href="index.html" class="active">Dashboard</a></li>
        <li><a href="pages/tracker.html">Benefits</a></li>
        <li><a href="pages/categories.html">Categories</a></li>
        <li><a href="pages/partners.html">Transfer Partners</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <!-- Hero Section -->
    <section class="hero" style="padding: 2rem;">
      <h1 style="font-size: 2rem;">üëã Welcome to CardMax</h1>
      <p>Select the credit cards you own to track benefits and maximize your rewards.</p>
    </section>

    <!-- Quick Stats -->
    <div class="quick-stats" id="quick-stats">
      <div class="quick-stat-card">
        <div class="quick-stat-value" id="stat-my-cards">0</div>
        <div class="quick-stat-label">My Cards</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-value" id="stat-annual-fees">$0</div>
        <div class="quick-stat-label">Annual Fees</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-value" id="stat-total-credits">$0</div>
        <div class="quick-stat-label">Credits Available</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-value" id="stat-net-value">$0</div>
        <div class="quick-stat-label">Net Value</div>
      </div>
    </div>

    <!-- My Cards Section -->
    <section class="my-cards-section" id="my-cards-section">
      <h2>üóÇÔ∏è My Cards</h2>
      <div id="my-cards-list">
        <!-- User's selected cards will be shown here -->
      </div>
      <div class="save-actions">
        <span class="save-status" id="save-status">Changes not saved</span>
        <button class="btn btn-primary" id="save-btn" onclick="saveMyCards()">üíæ Save My Cards</button>
      </div>
    </section>

    <!-- Add Cards Section -->
    <section>
      <div class="my-cards-header">
        <h2 style="margin: 0;">‚ûï Add Cards to Your Collection</h2>
        <div class="search-container">
          <span class="search-icon">üîç</span>
          <input type="text" class="search-input" id="card-search" placeholder="Search cards..." oninput="filterCardSelector()">
        </div>
      </div>

      <div class="card-selector-grid" id="card-selector">
        <!-- All available cards will be listed here -->
      </div>
    </section>

    <!-- Save/Restore Section -->
    <section style="margin-top: 2rem;">
      <div id="save-restore-ui"></div>
    </section>
  </div>

  <script src="data/cards.js"></script>
  <script src="js/save-code.js"></script>
  <script>
    // State
    let selectedCards = [];
    let cardSignupDates = {};
    let hasUnsavedChanges = false;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadSavedData();
      renderCardSelector();
      renderMyCards();
      updateQuickStats();

      // Initialize save/restore UI
      if (typeof CardMaxSave !== 'undefined') {
        CardMaxSave.renderSaveRestoreUI('save-restore-ui');
      }
    });

    // Load saved data
    function loadSavedData() {
      const saved = localStorage.getItem('cardmax_user_cards');
      const savedDates = localStorage.getItem('cardmax_signup_dates');

      if (saved) {
        selectedCards = JSON.parse(saved);
      }

      if (savedDates) {
        cardSignupDates = JSON.parse(savedDates);
      }
    }

    // Save data
    function saveMyCards() {
      localStorage.setItem('cardmax_user_cards', JSON.stringify(selectedCards));
      localStorage.setItem('cardmax_signup_dates', JSON.stringify(cardSignupDates));

      hasUnsavedChanges = false;
      updateSaveStatus();

      // Show toast
      if (typeof CardMaxSave !== 'undefined') {
        CardMaxSave.showToast('Cards saved successfully!');
      } else {
        alert('Cards saved!');
      }
    }

    // Mark changes as unsaved
    function markUnsaved() {
      hasUnsavedChanges = true;
      updateSaveStatus();
    }

    // Update save status indicator
    function updateSaveStatus() {
      const status = document.getElementById('save-status');
      if (hasUnsavedChanges) {
        status.textContent = '‚óè Changes not saved';
        status.classList.remove('saved');
      } else {
        status.textContent = '‚úì All changes saved';
        status.classList.add('saved');
      }
    }

    // Filter card selector
    function filterCardSelector() {
      const query = document.getElementById('card-search').value.toLowerCase();
      const items = document.querySelectorAll('.card-selector-item');

      items.forEach(item => {
        const name = item.dataset.name.toLowerCase();
        const issuer = item.dataset.issuer.toLowerCase();
        if (name.includes(query) || issuer.includes(query)) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Render card selector grid
    function renderCardSelector() {
      const container = document.getElementById('card-selector');

      // Sort cards: selected first, then by issuer
      const sortedCards = [...CARDS_DATABASE].sort((a, b) => {
        const aSelected = selectedCards.includes(a.id) ? 0 : 1;
        const bSelected = selectedCards.includes(b.id) ? 0 : 1;
        if (aSelected !== bSelected) return aSelected - bSelected;
        return a.issuer.localeCompare(b.issuer);
      });

      container.innerHTML = sortedCards.map(card => {
        const isSelected = selectedCards.includes(card.id);
        const shortIssuer = getShortIssuer(card.issuer);
        return `
          <div class="card-selector-item ${isSelected ? 'selected' : ''}"
               data-id="${card.id}"
               data-name="${card.name}"
               data-issuer="${card.issuer}"
               onclick="toggleCardSelection('${card.id}')">
            <div class="card-color-bar" style="background: ${card.color}"></div>
            <div class="card-details">
              <div class="card-name">${shortIssuer} ${getShortCardName(card.name)}</div>
              <div class="card-issuer">${card.issuer}</div>
              <div class="card-fee">$${card.annualFee}/year</div>
            </div>
            <div class="card-checkbox">${isSelected ? '‚úì' : ''}</div>
          </div>
        `;
      }).join('');
    }

    // Get short issuer name
    function getShortIssuer(issuer) {
      const shortNames = {
        'Chase': 'Chase',
        'American Express': 'Amex',
        'Capital One': 'C1',
        'Citi': 'Citi',
        'Bank of America': 'BoA',
        'Wells Fargo': 'WF',
        'US Bank': 'USB',
        'Discover': 'Disc',
        'Cardless': 'Bilt'
      };
      return shortNames[issuer] || issuer;
    }

    // Get short card name (remove issuer prefix)
    function getShortCardName(name) {
      // Remove common prefixes
      return name
        .replace(/^Chase /, '')
        .replace(/^American Express /, '')
        .replace(/^Capital One /, '')
        .replace(/^Citi /, '')
        .replace(/^Bank of America /, '')
        .replace(/^Wells Fargo /, '')
        .replace(/^US Bank /, '')
        .replace(/^Discover /, '')
        .replace(/^Bilt /, '');
    }

    // Toggle card selection
    function toggleCardSelection(cardId) {
      const index = selectedCards.indexOf(cardId);
      if (index > -1) {
        selectedCards.splice(index, 1);
        delete cardSignupDates[cardId];
      } else {
        selectedCards.push(cardId);
      }

      markUnsaved();
      renderCardSelector();
      renderMyCards();
      updateQuickStats();
    }

    // Remove card from my cards
    function removeCard(cardId) {
      const index = selectedCards.indexOf(cardId);
      if (index > -1) {
        selectedCards.splice(index, 1);
        delete cardSignupDates[cardId];
      }

      markUnsaved();
      renderCardSelector();
      renderMyCards();
      updateQuickStats();
    }

    // Render my cards list
    function renderMyCards() {
      const container = document.getElementById('my-cards-list');

      if (selectedCards.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No cards selected yet</h3>
            <p>Click on cards below to add them to your collection</p>
          </div>
        `;
        return;
      }

      const months = ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      const currentYear = new Date().getFullYear();
      const years = [''];
      for (let y = currentYear; y >= currentYear - 20; y--) {
        years.push(y);
      }

      container.innerHTML = selectedCards.map(cardId => {
        const card = CARDS_DATABASE.find(c => c.id === cardId);
        if (!card) return '';

        const signupDate = cardSignupDates[cardId] || {};
        const shortIssuer = getShortIssuer(card.issuer);

        return `
          <div class="my-card-item">
            <div class="card-color-dot" style="background: ${card.color}"></div>
            <div class="card-info">
              <div class="card-title">${shortIssuer} ${getShortCardName(card.name)}</div>
              <div class="card-subtitle">$${card.annualFee}/year</div>
            </div>
            <div class="date-picker-group">
              <label>Sign-up:</label>
              <div class="month-year-picker">
                <select onchange="updateSignupDate('${cardId}', 'month', this.value)">
                  ${months.map((m, i) => `<option value="${i}" ${signupDate.month === i ? 'selected' : ''}>${m || 'Month'}</option>`).join('')}
                </select>
                <select onchange="updateSignupDate('${cardId}', 'year', this.value)">
                  ${years.map(y => `<option value="${y}" ${signupDate.year == y ? 'selected' : ''}>${y || 'Year'}</option>`).join('')}
                </select>
              </div>
            </div>
            <button class="remove-btn" onclick="removeCard('${cardId}')" title="Remove card">‚úï</button>
          </div>
        `;
      }).join('');
    }

    // Update signup date
    function updateSignupDate(cardId, field, value) {
      if (!cardSignupDates[cardId]) {
        cardSignupDates[cardId] = {};
      }

      cardSignupDates[cardId][field] = parseInt(value) || null;
      markUnsaved();
    }

    // Update quick stats
    function updateQuickStats() {
      let totalFees = 0;
      let totalCredits = 0;

      selectedCards.forEach(cardId => {
        const card = CARDS_DATABASE.find(c => c.id === cardId);
        if (!card) return;

        totalFees += card.annualFee;

        card.credits.forEach(credit => {
          if (typeof credit.amount === 'number' && credit.type !== 'points') {
            totalCredits += credit.amount;
          }
        });
      });

      const netValue = totalCredits - totalFees;

      document.getElementById('stat-my-cards').textContent = selectedCards.length;
      document.getElementById('stat-annual-fees').textContent = '$' + totalFees.toLocaleString();
      document.getElementById('stat-total-credits').textContent = '$' + totalCredits.toLocaleString();
      document.getElementById('stat-net-value').textContent = (netValue >= 0 ? '+$' : '-$') + Math.abs(netValue).toLocaleString();
      document.getElementById('stat-net-value').style.color = netValue >= 0 ? 'var(--accent-green)' : 'var(--accent-orange)';
    }
  </script>
</body>
</html>
